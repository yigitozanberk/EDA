---
title: "EDA_W2_CN"
author: "yob"
date: "4/29/2019"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.



##Week 2

##Lattice Plotting System

For making many many plots at once, useful to see looking at one varialbe by other variables

lattice package also includes grid package. but we seldom call functions from the grid package directly.

lattice plotting system does not have a two-phase aspect like the base system.

you have to plot with a single function call


xyplot: for making scatterplots
bwplot : box-and-whiskers plots(boxplots)
histogram: histograms
stripplot: like a boxplot but with actual points
dotplot : plot dots on "violin strings
splom: scatterplot matrix; like *pairs* in base plotting system
levelplot, contourplot: for plotting "image" data


#details
xyplot(y ~ x | f * g, data)

f and g are conditioning variables, they are optional

```{r}
library(lattice)
library(datasets)
xyplot(Ozone ~ Wind , data = airquality)

```

```{r}
airquality <- transform(airquality, Month = factor(Month))
xyplot(Ozone ~ Wind | Month, data = airquality, layout = c(5, 1))
```
multidimensional panels are very simple with just one line.




#behavior

base graphics functions plot data directly to the graphics device

lattice graphics functions return an object of class trellis

lattice functions return 'plot objects'

on the command line, trellis objects are auto-printed


```{r}
p <- xyplot(Ozone ~ Wind, data = airquality)
#nothing happens
print(p)
#plot appears
```



##Part 2

lattice functions have a panel function which controls what happens inside each panel of the plot.

panel functions receive the x/y coordinates of the data points in their panel

```{r}
set.seed(10)
x <- rnorm(100)
f <- rep(0:1, each = 50)
y <- x + f - f * x + rnorm(100, sd = 0.5)
f <- factor(f, labels = c("Group1", "Group2"))
xyplot(y ~ x | f, layout = c(2,1))
```



```{r}
#Custom panel function
xyplot(y ~ x|f, panel = function(x, y, ...){
        panel.xyplot(x, y, ...) # First call default panel function
        panel.abline(h = median(y), lty = 2) #Add a horizontal line at the median
})
```


```{r}
xyplot(y ~ x|f, panel = function(x, y, ...){
        panel.xyplot(x, y, ...) # First call default panel function
        panel.lmline(x, y, col = 2) #overlay a simple linear regression line
})
```


##YOU CAN'T MIX FUNCTIONS FROM DIFFERENT PLOTTING SYSTEMS

#many panel lattice plot
baltimore astma study

question: how does indoor airborne mouse allergen vary over time and accross subjects?

150 subjects
each with 5 visits

*easiest way is lattice plot*

ders slaytinda var ama burada data olmadigi icin plot yok.

you can see variation accross subjects, variations within subjects

you can see missing values. all subjects must have 5 points, but some have 3 or less in the plot. why is the data missing

#summary

lattice system is ideal for creating conditioning plots where you examine the same kind of plot under many different conditions

##ggplot2

```{r}
library(ggplot2)
```

implementation of the *Grammar of Graphics* by Leland Wilkinson

written by Hadley Wickham while he was a graduate student at Iowa State

a "third" graphics system for R, along with *base* and *lattice*

www.ggplot2.org

- think 'verb' 'noun' and 'adjective' for graphics

you want to shorten the distance from mind to page

allows for a 'theory' of graphics


qplot()
works much like the plot() function in base graphics

looks for data in a data frame, similar to lattice, or in the parent environment

plots are made up of aesthetics(size, shape, color) and geoms(points, lines)

factors are important for indicating subsets of the data(if they are to have different properties); they should be labeled

the qplot() hides what goes on underneath, which is okay for most operations

ggplot() is the core function and very flexible for doing things qplot() cannot do.



```{r}
library(ggplot2)
str(mpg)
```



```{r}
qplot(displ, hwy, data = mpg)
```



modifying aesthetics &classifying by drv column

```{r}
qplot(displ, hwy, data = mpg, color = drv)

```

front wheel drives have the highest milage

adding a geom (a summary)

```{r}
qplot(displ, hwy, data = mpg, geom = c("point", "smooth"))
```

smooth is the blue line that goes accross


```{r}
qplot(hwy, data = mpg, fill = drv)
#plotting histograms by specifying only one variable
```

facets

```{r}
qplot(displ, hwy, data = mpg, facets = .~drv)
#if you don't want to look at the same graph with different
#colour data, you can separate the data into different facets
```

```{r}
qplot(hwy, data = mpg, facets = drv ~ ., binwidth = 2)
```

next lecture example not in R

--


you can do logs of variables

qplot(log(eno), data = maacs, fill = mopos)

qplot(log(eno), data = maacs, geom = "density")

qplot(log(pm25), log(eno), data = maacs, shape = mopos, color = mopos)

+ geom_smooth(method = "lm")

#qplot summary
syntax somewhere in between base/lattice

produces very nice graphics, essentially publication ready

if you want to customize, use full power of ggplot function

##PArt 3

basic components of a ggplot2 plot

- data frame

-aesthetic mappings

- geoms : geometric object like points, lines, shapes

-facets : for conditional plot

-stats : statistical transformations like binning, quantiles, smoothing

-scales : what scale an aesthetic map uses. example male= red, female = blue

-coordinate system


when building plots in ggplot2, the artist's palette model may be the closest analogy.

plots are built up in layers

-plot the data
-overlay a summary
- metadata and annotation


qplot(logpm25, NocturnalSympt, data = maacs, facets = . ~bmicat, geom = c("point", "smooth"), method = "lm")

working with ggplot

head(maacs[, 1:3])

g <- ggplot(maacs, aes(logpm25, NocturnalSympt))

summary(g)

print(g) 
Error : No layers in plot

p <- g + geom_point() #save and print ggplot object
print(p)

g + geom_point() #plot object without saving

defaults are used in geom_point() function because the data has the defaults in ggplot object

##Part 4

adding more layers: smoth

g + geom_point() + geom_smooth()

or

g + geom_point() + geom_smooth(method = "lm") #to eliminate the noise in the default method

facets

g + geom_point() + facet_grid(.~ bmicat) + geom_smooth(method = "lm")

the order doesn't matter, as long as it's between point and smooth function

labels come from the levels of factor variables. you can use them

#annotation

labels : xlab(), ylab(), labs(), ggtile()

each of the 'geom' functions has options to modify

for thins that only make sense globally, use theme()
like theme(legend.position = "none")

two standard appearance themse are included
theme_gray() : default theme
theme_bw() : more stark/plain black and white



g + geom_point(color = "steelblue", size = 4, alpha = 1/2)

important thing here is, the color, size and alpha are set to constants. you can assign data variables instead of constants.

alpha is transparency

+ labs(x = expression("log PM[2.5]"), y = "NocturnalSymptoms")

+geom_smooth(size = 4, linetype = 3, method = "lm", se = FALSE)

linetype = 3 is dotted line

+theme_bw(base_family = "Times") 
change the theme to black and white, and change the font to *Times*


##Part 5

notes about axis limits

when there are outliers, you may not want to look at the outlier. 

if you do this:

g + geom_line() + ylim(-3, 3)

ggplot function excludes the outlier data. it takes a subset of your data. so your outlier is not included 

but if you do this:

g + geom_line() + coord_cartesian(ylim = c(-3, 3))
then ggplot also includes the outlier into the plot, but doesn't concentrate on it.

so. if you don't want to lose the outlier, use coord_cartesian(ylim = ...)


#more complex examples

varying by 2 variables

NO2 variable is a continuous variable. you can't condition on a continuous variable.so you need to categorize the variable.

cut()

calculate the deciles of the data
cutpoints <- quantile(maacs$logno2_new, seq(0, 1, length = 4), na.rm= T)

cut the data at the deciles and create a new factor variable
maacs$no2dec <- cut(maacs$logno2_new, cutpoints)

see the levels of the newly created factor variable

levels(maacs$no2dec)



g <- ggplot(maacs, aes(logpm25, NocturnalSympt))

g + geom_point(alpha = 1/3) #add points
 + facet_wrap(bmicat ~ no2dec, nrow = 2, ncol = 4) #make panels
  + geom_smooth(method = "lm", se = F, col = "steelblue")#add smoother
  + theme_bw(base_family = "Avenir", base_size = 10) #change theme
  + labs(x = expression("log " * PM[2.5]))
  + labs(y = "Nocturnal Symptoms")
  + labs(title = "MAACS Cohort")
  
  

you could save this to a new object. then you could add more layers.


#summary

ggplot2 is very powerful and flexible if you learn the 'grammar' and the various elements that can be tuned/modified



#Swirl

lattice plotting system
working with colors
ggplot2 part 1
ggplot2 part 2
ggplot2 extras



